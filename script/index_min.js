function Deferred(){this.resolve=null,this.reject=null,this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this)),Object.freeze(this)}var HttpLib,StyleLib;HttpLib||(HttpLib=function(){"use strict";let t=function(t,e,n){let o=function(t){let e=new FormData;for(const n in t)t.hasOwnProperty(n)&&e.append(n,t[n]);return e}(e),s=new XMLHttpRequest;s.open("POST",t,!0),s.onload=function(){n(s.status,s.response)},s.send(o)};HttpLib.post=function(e,n,o){let s=new Deferred,l=s.promise;return t(e,n,function(t,e){if(200!==t)s.reject();else{let n={status:t,json:JSON.parse(e)};if(s.resolve(n),null==o)return;o(n)}}),l},HttpLib.postJson=function(t,e,n){let o=new XMLHttpRequest;o.open("POST",t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText)},o.send(JSON.stringify(e))},HttpLib.fetchResource=function(t,e){return fetch(t,{method:"GET",referrer:"no-referrer"}).then(function(t){return t.text()}).then(e)},HttpLib.fetchBinaryResource=function(t,e){let n=new XMLHttpRequest;n.onload=function(t){e(n.response)},n.open("GET",t),n.responseType="arraybuffer",n.send()}})(),StyleLib||(StyleLib={},function(){"use strict";StyleLib.getColorPickerSvg=function(t,e){return`data:image/svg+xml;base64,${btoa(`<svg height="${e}" width="${t}" xmlns="http://www.w3.org/2000/svg" version="1">\n\t\t\t\t\t\t\t<foreignObject class="label" x="0" y="0" width="${t}" height="${e}">\n\t\t\t\t\t\t\t\t<div xmlns="http://www.w3.org/1999/xhtml">\n\t\t\t\t\t\t\t\t\t<div class="spectrum" style="width:168px; height:23px;"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<style xmlns="http://www.w3.org/1999/xhtml">\n\t\t\t\t\t\t\t\t\t.spectrum {\n\t\t\t\t\t\t\t\t\t\tbackground: linear-gradient(to right, \n\t\t\t\t\t\t\t\t\t\trgb(255,   0,   0) 0%,\n\t\t\t\t\t\t\t\t\t\trgb(255, 255,   0) 16.67%,\n\t\t\t\t\t\t\t\t\t\trgb(  0, 255,   0) 33.33%,\n\t\t\t\t\t\t\t\t\t\trgb(  0, 255, 255) 50%,\n\t\t\t\t\t\t\t\t\t\trgb(  0,   0, 255) 66.67%,\n\t\t\t\t\t\t\t\t\t\trgb(255,   0, 255) 83.33%,\n\t\t\t\t\t\t\t\t\t\trgb(255,   0,   0) 100%\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t</foreignObject>\n\t\t\t\t\t\t</svg>`)}`},StyleLib.mergeStyles=function(t,e){let n=t,o=e,s=typeof t,l=typeof e;if("object"!==s){if("string"!==s)throw`The provided styles cannot be merged as they are not compatible types. The parameter 'x' is of type '${s}'.`;n=StyleLib.createStyleObject(t)}if("object"!==l){if("string"!==l)throw`The provided styles cannot be merged as they are not compatible types. The parameter 'y' is of type '${l}'.`;o=StyleLib.createStyleObject(e)}let i=Object.keys(n),r=Object.keys(o);for(const t of i){let e=0;for(;e<r.length&&0!==t.localeCompare(r[e]);e++);e<r.length||(o[t]=n[t])}return o},StyleLib.getStyleString=function(t){let e="",n=Object.keys(t);for(const o of n)e=e.concat(`${o.trim()}: ${t[o].trim()}; `);return e.trim()},StyleLib.createStyleObject=function(t){let n=t.split(";"),o=e(n),s={};for(const t of o)for(const e of n){if(0===e.trim().length)continue;let n=e.trim().split(":");if(0==n[0].localeCompare(t)){s[n[0].trim()]=n[1].trim();break}}return s},StyleLib.isStylesEqual=function(e,n){let o=StyleLib.createStyleObject(e),s=StyleLib.createStyleObject(n),l=[...Object.keys(o)],i=[...Object.keys(s)];for(const t of i){let e=0;for(;e<l.length&&0!==t.localeCompare(l[e]);e++);e<l.length?l.splice(e,1):o[t]="none"}for(const t of l)s[t]="none";let r=[...Object.keys(o)];for(const e of r){if(!0!==(o[e]===s[e]||!0===t(o[e],s[e])))return!1}return!0};let t=function(t,e){return t===e||("unset"===t&&(t="none"),"unset"===e&&(e="none"),t===e)},e=function(t){let e=[];for(const n of t){if(0===n.trim().length)continue;let t=n.trim().split(":"),o=[...e],s=0;for(const n of o)if(s++,!(t[0].localeCompare(n)>=0)){e.splice(s-1,0,t[0]);break}s>=e.length&&e.push(t[0])}return e}}());class CustomElementBase extends HTMLElement{constructor(){super()}connectedCallback(){this.render()}attributeChangedCallback(t,e,n){e!==n&&this.getAttribute(t)&&this.setAttribute(t,n)}render(){if(!this.initialize||!this.markup)return;this.initialize();let t=this.markup(),e=document.createElement("div");e.innerHTML=t,this.attachShadow({mode:"open"}).appendChild(e.firstChild.content.cloneNode(!0))}append(t,e,n){return n.nextSibling?t.insertBefore(e,n.nextSibling):t.appendChild(e)}prepend(t,e,n){return t.insertBefore(e,n)}createElement(t){let e=document.createElement("div");return e.innerHTML=t,e.firstChild}triggerEvent(t,e,n){n.dispatchEvent(new CustomEvent(t,{detail:e}))}getWebApi(t,e){return fetch(t,{method:"GET",referrer:"no-referrer"}).then(function(t){return t.text()}).then(e)}postWebApi(t,e,n){let o=new XMLHttpRequest;o.open("POST",t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText)},o.send(JSON.stringify(e))}}class TextEditBase extends CustomElementBase{constructor(){super()}initialize(){this.setText=this.setText.bind(this),this.setInnerHTML=this.setInnerHTML.bind(this),this.applyStyling=this.applyStyling.bind(this),this.getContentMarkup=this.getContentMarkup.bind(this);let t=this;customElements.whenDefined("text-edit-template").then(function(){t.setupView(),t.setupBehavour()})}getContentMarkup(){return this.getPreElement().innerHTML}setText(t){let e=this.getPreElement();for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0]);t.indexOf("\r\n")<0&&(t=this.replaceText("\n","\r\n"));let n=t.split("\r\n");for(let t=0;t<n.length;t++)e.appendChild(document.createTextNode(n[t]+"\r\n"))}setInnerHTML(t){let e=this.getPreElement();for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0]);e.innerHTML=t}markup(){return this.createMarkup(0,0)}createMarkup(t,e){return`<template id='text-edit-template'>\n\t\t\t\t\t\n\t\t\t\t\t<div style='float: left; width: 100%; height: 100%; position: relative;'>\n\t\t\t\t\t\t<div class='div-back-layer'></div>\n\t\t\t\t\t\t<div class='div-text-container'>\n\t\t\t\t\t\t\t\x3c!--<scroll-container-template scrollbarwidth='${t}' contentheight='${e}'></scroll-container-template>--\x3e\n\t\t\t\t\t\t\t<pre contenteditable="" spellcheck="false" class="pre-wrap-ex" style="float: left; height: 100%; outline-style: none;">Hello World</pre>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<style>\n\t\t\t\t\t\tdiv, pre {\n\t\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\t\tborder: 0;\n\t\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\t\tfont-family: monospace;/*Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;*/\n\t\t\t\t\t\t\tline-height: 20px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tpre {\n\t\t\t\t\t\t\tfloat: left;\n\t\t\t\t\t\t\twidth: calc(100% - ${t}px);\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tpadding-top: 0px;\n\t\t\t\t\t\t\tpadding-left: calc(3px + 15px);\n\t\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\t\ttop: 0px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tprebak::selection{\n\t\t\t\t\t\t\tcolor: brown;\n\t\t\t\t\t\t\tbackground-color: chocolate;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tpre::selection {\n\t\t\t\t\t\t\tbackground-color: #ffa50078;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tspan::selection {\n\t\t\t\t\t\t\tbackground-color: #ffa50078;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tscroll-container-template {\n\t\t\t\t\t\t\tfloat: right;\n\t\t\t\t\t\t\twidth: ${t}px;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.div-text-container {\n\t\t\t\t\t\t\tfloat: left;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t#pre-wrap {\n\t\t\t\t\t\t\twhite-space: pre-wrap;       /* css-3 */\n\t\t\t\t\t\t\twhite-space: -moz-pre-wrap;  /* Mozilla, since 1999 */\n\t\t\t\t\t\t\twhite-space: -pre-wrap;      /* Opera 4-6 */\n\t\t\t\t\t\t\twhite-space: -o-pre-wrap;    /* Opera 7 */\n\t\t\t\t\t\t\tword-wrap: break-word;       /* Internet Explorer 5.5+ */\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.div-back-layer {\n\t\t\t\t\t\t\tfloat:left;\n\t\t\t\t\t\t\twidth: calc(100% - ${t}px); /*The back-layer can only be as wide as the pre element*/\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tz-index: 0;\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t</template>`}setupView(){let t=this.getPreElement(),e=this.getPreLayerElement();t.style.top="0px",this.setupPreLayerView(e),this.setupPreLayerBehavour(e,t)}setupPreLayerView(t){let e=parseFloat(t.clientHeight),n=parseInt(getComputedStyle(t).lineHeight),o=e/n,s=this.createPreLayerMarkup(o,n);t.innerHTML=s}setupPreLayerBehavour(t,e){let n=this.getPreContainerElement(),o=this;for(const t of[n])t.addEventListener("mousedown",function(e){t.style.pointerEvents="none";let n=o.shadowRoot.elementFromPoint(e.clientX,e.clientY);t.style.pointerEvents="";let s=o.shadowRoot.ownerDocument.createEvent("MouseEvents");s.initEvent("mousedown",!0,!0),n.dispatchEvent(s)});let s=[...t.childNodes];for(const t of s)t.addEventListener("mousedown",function(e){let n=t.parentElement;for(let e=0;e<n.childNodes.length;e++)n.childNodes[e]!==t&&(n.childNodes[e].style.backgroundColor="white");"rgb(176 190 197)"===t.style.backgroundColor?t.style.backgroundColor="white":t.style.backgroundColor="rgb(176 190 197)"})}createPreLayerMarkup(t,e){let n=[];for(let o=0;o<t-1;o++)n.push(`<div style='float: left; width: 100%; height: ${e}px; top: ${o*e}px; left: 0px; background-color: white; position: absolute; opacity: 0.3; z-index: 0;'>${o+1}</div>`);return n.join("")}setupBehavour(){let t=this,e=this.getPreElement();e.addEventListener("keypress",function(n){t.handleOnKeyPress(e,n)}),e.addEventListener("keydown",function(n){t.handleOnKeyDown(e,n)})}handleOnKeyPress(t,e){let n=!1;return"Enter"===e.key&&(n=this.handleOnEnterKey(t,e),!0===n&&e.preventDefault()),!0!==n}handleOnKeyDown(t,e){let n=!1;return"Backspace"===e.key&&(n=this.handleOnBackspaceKey(t,e),!0===n&&e.preventDefault()),!0!==n}handleOnEnterKey(t,e){let n=this.getSelection();return!n||this.removeSelectedText(n,"\r\n",!1)}handleOnBackspaceKey(t,e){}removeSelectedText(t,e,n){let o,s,l=this.getPreElement();if(t.baseNode===t.restNode){if(e.length>1&&e.indexOf("\n")>=0&&e.indexOf("\r")<0||e.length>2&&e.indexOf("\r\n")>=0)throw`An attempt to replace the selected '${t.restOffset-t.baseOffset}' chars with a multi-line string failed.`;if(0===t.baseOffset){if(t.restOffset!==t.restNode.textContent.length){if(0===e.length)return t.baseNode.textContent=t.baseNode.textContent.slice(t.restOffset),!0;if(!0===n){if(!0===this.equalsNewline(e))throw"An attempt to replace the selected-text with a newline failed since styling cannot be applied to the newline text";return t.baseNode.textContent=e+t.baseNode.textContent.slice(t.restOffset),!0}let o=document.createTextNode(e);return!0===this.equalsNewline(e)&&(o.textContent=" "+o.textContent),t.baseNode.textContent=t.baseNode.textContent.slice(t.restOffset),l.insertBefore(o,t.baseNode),!0}if(e.length>0){if(!0===n){if(!0===this.equalsNewline(e))throw"An attempt to replace the selected-text with a newline failed since styling cannot be applied to the newline text";return t.baseNode.textContent=e,!0}let o=document.createTextNode(e);!0===this.equalsNewline(e)&&(o.nextSibling=document.createTextNode(" ")),l.appendChild(o)}l.removeChild(t.baseNode)}else{if(t.restOffset===t.restNode.textContent.length){if(0===e.length)return t.baseNode.textContent=t.baseNode.textContent.slice(0,t.baseOffset),!0;if(!0===n){if(!0===this.equalsNewline(e))throw"An attempt to replace the selected-text with a newline failed since styling cannot be applied to the newline text";return t.baseNode.textContent=t.baseNode.textContent.slice(0,t.baseOffset).concat(e),!0}if("#text"===t.baseNode.nodeName)return t.baseNode.textContent=t.baseNode.textContent.slice(0,t.baseOffset).concat(e),!0===this.equalsNewline(e)&&this.appendChildNode(l,document.createTextNode(" "),t.baseNode),!0;{t.baseNode.textContent=t.baseNode.textContent.slice(0,t.baseOffset);let n=document.createTextNode(e);return n=this.appendChildNode(l,n,t.baseNode),!0===this.equalsNewline(e)&&this.appendChildNode(l,document.createTextNode(" "),n),!0}}if(t.restOffset!==t.restNode.textContent.length){let o=t.baseNode.textContent.slice(0,t.baseOffset),s=t.baseNode.textContent.slice(t.restOffset);if(0===e.length)return t.baseNode.textContent=o+s,!0;if(!0===n){if(!0===this.equalsNewline(e))throw"An attempt to replace the selected-text with a newline failed since styling cannot be applied to the newline text";return t.baseNode.textContent=o+e+s,!0}if("#text"===t.baseNode.nodeName)t.baseNode.textContent=o+e,!0!==this.equalsNewline(e)?t.baseNode.textContent=t.baseNode.textContent.concat(s):this.appendChildNode(l,document.createTextNode(s),t.baseNode);else{let n=document.createTextNode(e);this.appendChildNode(l,n,t.baseNode);let i=t.baseNode.cloneNode(!0);i.textContent=s,t.baseNode.textContent=o,this.appendChildNode(l,i,n)}}}return!0}let i="";"#text"!==t.baseNode.nodeName&&(i=this.getStyle(t.baseNode));let r="";"#text"!==t.restNode.nodeName&&(r=this.getStyle(t.restNode)),0===t.baseOffset?o=t.baseNode:(o=t.baseNode.cloneNode(!0),o.textContent=t.baseNode.textContent.slice(t.baseOffset),t.baseNode.textContent=t.baseNode.textContent.slice(0,t.baseOffset),l.insertBefore(o,t.baseNode.nextSibling)),t.restOffset===t.restNode.textContent.length?s=t.restNode:(s=t.restNode.cloneNode(!0),s.textContent=t.restNode.textContent.slice(0,t.restOffset),t.restNode.textContent=t.restNode.textContent.slice(t.restOffset),l.insertBefore(s,t.restNode));let d=o;for(;d!==t.restNode;){let t=d.nextSibling;l.removeChild(d),d=t}if(0===e.length)return!0!==StyleLib.isStylesEqual(i,r)||(t.baseNode.textContent=t.baseNode.textContent.concat(t.restNode.textContent),l.removeChild(t.restNode)),!0;let a=[],c=this.replaceText(e,"\r\n","\n").split("\n");for(let t=0;t<c.length-1;t++)a.push(c[t]);let h,p,f="\r\n";d=t.baseNode;let b=0;for(const t of a)b>0&&(""===i?(d.textContent=d.textContent.concat(f),p=d):p=this.appendChildNode(l,document.createTextNode(f),d)),0===t.length?""===i?(b>0?p=this.appendChildNode(l,document.createTextNode(" \r\n"),p):d.textContent=d.textContent.concat(f),b<e.length-1&&(d=this.appendChildNode(l,document.createTextNode(" "),p))):b>0?!0===n?(h=d.cloneNode(!0),h.textContent=" ",d=this.appendChildNode(l,h,p),p=this.appendChildNode(l,document.createTextNode(f),d),b<e.length-1&&(h=d.cloneNode(!0),h.textContent=" ",d=this.appendChildNode(l,h,p))):(p=this.appendChildNode(l,document.createTextNode(" \r\n"),d),b<e.length-1&&(d=this.appendChildNode(l,document.createTextNode(" "),p))):""===i?d.textContent=d.textContent.concat(f):p=this.appendChildNode(l,document.createTextNode(f),d):b>0?""===i?d=this.appendChildNode(l,document.createTextNode(t),p):!0===n?(cloneNode=d.cloneNode(!0),cloneNode.textContent=t,d=this.appendChildNode(l,cloneNode,p)):d=this.appendChildNode(l,document.createTextNode(t),p):""===i||!0===n?d.textContent=d.textContent.concat(t):d=this.appendChildNode(l,document.createTextNode(t),d),b++;if(d===t.restNode.previousSibling&&d.textContent.indexOf("\n")===d.textContent.length-1)return!0;if(d!==t.restNode.previousSibling)return!0;if(d!==t.restNode.previousSibling)throw"The current-node should be on the same line of text as the end-node";if(!1===StyleLib.isStylesEqual(i,r))return!0;d.textContent=d.textContent.concat(t.restNode.textContent),l.removeChild(t.restNode)}getNodeStyle(t){return"#text"===t.nodeName?"":this.getStyle(t)}applyStyling(t){let e=this.getSelection();if(!e)return;let n,o=this.getPreElement(),s=this.getNodeStyle(e.baseNode),l=this.getNodeStyle(e.restNode),i=this.getMergedCssText(e.baseNode,t),r=this.getMergedCssText(e.restNode,t),d=e.baseNode.textContent;e.baseNode.textContent;if(e.baseNode===e.restNode){if(e.baseOffset===e.restOffset)return;if(0!==e.baseOffset){if(e.restOffset!==e.restNode.textContent.length){if(!0===StyleLib.isStylesEqual(s,i))return;return n=e.baseNode.cloneNode(!0),n.textContent=d.slice(e.baseOffset),e.baseNode.textContent=d.slice(0,e.baseOffset),this.appendChildNode(o,n,e.baseNode),e.restOffset=e.restOffset-e.baseOffset,e.restNode=n,e.baseOffset=e.baseNode.textContent.length,void this.splitSuffixText(o,e.restNode,e.restOffset,i)}if(!0===StyleLib.isStylesEqual(s,i))return;return void this.splitPrefixText(o,e.baseNode,e.baseOffset,i)}if(!0===StyleLib.isStylesEqual(s,i))return;return e.restOffset!==e.restNode.textContent.length?void this.splitSuffixText(o,e.restNode,e.restOffset,i):""!==s?void this.setStyle(e.baseNode,i):(n=this.createStyledElement(e.baseNode.textContent,i),this.appendChildNode(o,n,e.baseNode),void o.removeChild(e.baseNode))}if(0!==e.restOffset&&e.restOffset!==e.restNode.textContent.length&&!0!==StyleLib.isStylesEqual(l,r)&&(this.splitSuffixText(o,e.restNode,e.restOffset,r),e.restOffset=0),0!==e.baseOffset&&e.baseOffset!==e.baseNode.textContent.length){if(!0!==StyleLib.isStylesEqual(s,i)){let t=e.baseNode.textContent.indexOf("\n");t===e.baseNode.textContent.length-1&&(e.baseNode.textContent.indexOf("\r")===t-1&&(t-=1),e.baseNode.textContent=e.baseNode.textContent.slice(0,t),n=this.appendChildNode(o,document.createTextNode("\r\n"),e.baseNode)),this.splitPrefixText(o,e.baseNode,e.baseOffset,i),e.baseOffset=e.baseNode.textContent.length}}else 0===e.baseOffset&&!1===this.isUndefined(e.baseNode.previousSibling)&&(e.baseNode=e.baseNode.previousSibling,e.baseOffset=e.baseNode.textContent.length);let a,c,h=e.baseNode,p=h.nextSibling,f=this.getNodeStyle(e.baseNode);for(;!0!==this.isUndefined(p)&&p!==e.restNode;)a=p.nextSibling,!0!==this.equalsNewline(p.textContent)?(c=this.getMergedCssText(p,t),!0===StyleLib.isStylesEqual(f,c)?(h.textContent=h.textContent.concat(p.textContent),o.removeChild(p)):("#text"===p.nodeName&&(n=this.appendChildNode(o,document.createElement("span"),p),n.textContent=p.textContent,o.removeChild(p),p=n),this.setStyle(p,c),f=c),h=p,p=a):(f="",p=a);if(0===e.baseOffset&&!0===this.isUndefined(e.baseNode.previousSibling))if(a=e.baseNode.nextSibling,i=this.getMergedCssText(e.baseNode,t),a===e.restNode){if(r=this.getMergedCssText(e.restNode,t),!0===StyleLib.isStylesEqual(r,i)){if(""===s){let t=this.createStyledElement(e.baseNode.textContent.concat(e.restNode.textContent),i);o.removeChild(e.baseNode),e.baseNode=o.insertBefore(t,e.restNode)}else this.setStyle(e.baseNode,i),e.baseNode.textContent=e.baseNode.textContent.concat(e.restNode.textContent);return void o.removeChild(e.restNode)}if(""===s){let t=this.createStyledElement(e.baseNode.textContent,i);o.removeChild(e.baseNode),e.baseNode=o.insertBefore(t,e.restNode)}else this.setStyle(e.baseNode,i)}else{let t=this.getNodeStyle(a);if(!0===StyleLib.isStylesEqual(t,i)){if(""===s){let t=this.createStyledElement(e.baseNode.textContent.concat(a.textContent),i);o.removeChild(e.baseNode),e.baseNode=o.insertBefore(t,a)}else this.setStyle(e.baseNode,i),e.baseNode.textContent=e.baseNode.textContent.concat(a.textContent);o.removeChild(a)}else if(""===s){let t=this.createStyledElement(e.baseNode.textContent,i);o.removeChild(e.baseNode),e.baseNode=o.insertBefore(t,a)}else this.setStyle(e.baseNode,i)}0!==e.restOffset&&(h=p.previousSibling,c=this.getMergedCssText(p,t),!0===StyleLib.isStylesEqual(f,c)&&(h.textContent=h.textContent.concat(p.textContent),o.removeChild(p)))}getSelection(){let t=this.getPreElement(),e=this.shadowRoot.getSelection();if(!e.anchorNode)return;let n={};if(n.baseOffset=e.baseOffset,n.restOffset=e.extentOffset,n.baseNode=this.getGenerationNode(e.anchorNode),n.restNode=this.getGenerationNode(e.extentNode),!0===this.equalsNewline(n.baseNode.textContent))throw"The start-node is a newline node";if(!0===this.equalsNewline(n.restNode.textContent))throw"The end-node is a newline node";let o;if(n.baseNode===n.restNode)return n.restOffset<n.baseOffset&&(o=n.restOffset,n.restOffset=n.baseOffset,n.baseOffset=o,o=n.restNode,n.restNode=n.baseNode,n.baseNode=o),n;let s=0,l=t.firstChild;for(;!0!==this.isUndefined(l)&&l!==n.baseNode;)l=l.nextSibling,++s;if(t.childNodes[s]!==n.baseNode)throw"Failed to locate the index of the base-node";n.baseNodeIndex=s;let i=0;for(l=t.firstChild;!0!==this.isUndefined(l)&&l!==n.restNode;)l=l.nextSibling,++i;if(t.childNodes[i]!==n.restNode)throw"Failed to locate the index of the rest-node";return n.restNodeIndex=i,i>=s||(o=n.restOffset,n.restOffset=n.baseOffset,n.baseOffset=o,o=n.restNode,n.restNode=n.baseNode,n.baseNode=o,o=n.restNodeIndex,n.restNodeIndex=n.baseNodeIndex,n.baseNodeIndex=o),n}createStyledElement(t,e){let n=document.createElement("span");return n.innerHTML=t,this.setStyle(n,e),n}replaceText(t,e,n){let o=t.indexOf(e);for(;o>=0;){let s=t.substring(0,o);t=s+n+t.substring(o+e.length);let l=e.length-n.length;o=t.indexOf(e,o+l)}return t}setStyle(t,e){t.setAttribute("style",e)}getStyle(t){return t.getAttribute("style")}splitPrefixText(t,e,n,o){let s=e.textContent,l=s.slice(0,n),i=s.slice(n);e.textContent=l;let r=this.createStyledElement(i,o);this.appendChildNode(t,r,e)}splitSuffixText(t,e,n,o){let s=e.textContent,l=s.slice(0,n),i=s.slice(n);e.textContent=i;let r=this.createStyledElement(l,o);t.insertBefore(r,e)}appendChildNode(t,e,n){return!0===this.isUndefined(n.nextSibling)?t.appendChild(e):t.insertBefore(e,n.nextSibling)}getGenerationNode(t){return!1===this.isUndefined(t.parentNode)&&"PRE"!==t.parentNode.nodeName?t.parentNode:t}getMergedCssText(t,e){let n=this.getNodeStyle(t),o=StyleLib.createStyleObject(n),s=StyleLib.createStyleObject(e),l=StyleLib.mergeStyles(o,s);return StyleLib.getStyleString(l)}equalsNewline(t){return 0===t.localeCompare("\n")||0===t.localeCompare("\r\n")}isUndefined(t){return null==t||void 0===t||0===t.length}getPreElement(){return this.shadowRoot.childNodes[1].childNodes[3].childNodes[3]}getPreLayerElement(){return this.shadowRoot.childNodes[1].childNodes[1]}getPreContainerElement(){return this.shadowRoot.childNodes[1].childNodes[3]}getScrollElement(){return this.shadowRoot.childNodes[1].childNodes[3].childNodes[1]}}function printTextContent(){printDocument(blobFromMarkup(createPrintDocMarkup(document.getElementsByTagName("text-edit-template")[0].getContentMarkup())))}function blobFromMarkup(t){return new Blob([t],{type:"text/html"})}function printDocument(t){let e=URL.createObjectURL(t);window.open(e,"_blank","location=yes,height=600,width=800,scrollbars=yes,status=yes"),URL.revokeObjectURL(e)}function setupTextEditContent(){setTimeout(function(){document.getElementsByTagName("text-edit-template")[0].setInnerHTML(getDefaultTextMarkup())},500)}function setupBehavour(){setupMenuEventHandlers(),setupScrollerEventHandlers()}function setupScrollerEventHandlers(){let t=document.querySelector("#div-color-picker > div:nth-child(2)"),e=document.querySelector("#div-color-picker > div:nth-child(2) > div");e.style.position="relative",e.style.left=0,e.addEventListener("mousemove",function(n){1===n.which&&scrollColors(t,e,n.movementX)})}function setupMenuEventHandlers(){let t=document.getElementById("div-sub-menu-items"),e=(document.querySelector("#div-chosen-colors > div:nth-child(4)"),document.getElementById("div-sub-menu-btn"),document.querySelector("#div-chosen-colors")),n=e.lastElementChild,o=document.getElementById("div-sub-menu-btn"),s=function(t){1===t.which&&applyStyling(t.target)};for(const t of e.children)t!==n&&t.addEventListener("mousedown",s);[n,o].forEach(e=>{e.addEventListener("mousedown",function(e){1===e.which&&t.classList.toggle("close")})});let l=document.querySelector("#div-open-file > input");l.addEventListener("change",function(t){l.files&&openFile(l.files[0])}),document.getElementById("div-open-file").addEventListener("mousedown",function(t){1===t.which&&l.click()}),document.getElementById("div-print").addEventListener("mousedown",function(t){1===t.which&&printTextContent()}),document.getElementById("div-color").addEventListener("mousedown",s)}function saveFileLegacy(t){let e=new File([t],"",{type:"text/plain"}),n=window.URL.createObjectURL(e),o=document.createElement("a");o.style.cssText="width: 0px; height: 0px; display: none;",document.body.appendChild(o),o.href=n,o.setAttribute("download","Untitled.txt"),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}function openFile(t){(t.text?t.text():readFile(t)).then(function(t){document.getElementsByTagName("text-edit-template")[0].setInnerHTML(t)})}function readFile(t){return new Promise(function(e,n){let o=new FileReader;o.addEventListener("loadend",function(t){let n=t.srcElement.result;e(n)}),o.readAsText(t)})}function applyStyling(t){let e=document.getElementsByTagName("text-edit-template")[0],n=t.style.backgroundColor;if(!n){n=getComputedStyle(t).backgroundColor}let o=`font-weight: bold; color: ${n};`;e.applyStyling(o)}function scrollColors(t,e,n){let o=parseFloat(e.style.left),s=parseFloat(e.clientWidth),l=parseFloat(t.clientWidth);if(n>0){let t=l-(o+s);if(t<=0)return;n>t&&(n=t)}else{let t=o+n;if(t<0&&(n=0-o),t<0)return}let i=o+n;e.style.left=`${i}px`;let r=document.querySelector("#div-color-picker > div:nth-child(1)");getPixedColor(i,3,r.clientWidth,r.clientHeight)}function getPixedColor(t,e,n,o){let s=new OffscreenCanvas(n,o).getContext("2d"),l=new Image;l.onload=function(){s.drawImage(l,0,0);let n=s.getImageData(t,e,1,1).data,o=n[0],i=n[1],r=n[2];document.getElementById("div-color").style.backgroundColor=`rgb( ${o}, ${i}, ${r} )`},l.src=StyleLib.getColorPickerSvg(n,o)}function createPrintDocMarkup(t){return`<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes"><style>body, div, pre {margin: 0;border: 0;padding: 0;box-sizing: border-box;}body > div, pre {float: left;width: 100%;height: 100%;}pre {padding-top: 15px;padding-left: 15px;line-height: 1.6em;font-family: monospace;white-space: pre-wrap;white-space: -moz-pre-wrap;white-space: -pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;outline-style: none;}</style></head><body><div><pre>${t}</pre></div></body></html>`}function getDefaultTextMarkup(){return'<span style="color: rgb(22 111 6);font-weight: bold;"> </span>&#xD;&#xA;<span style="color: rgb(22, 111, 6); font-weight: bold;">///</span> &#xD;&#xA;<span style="color: rgb(22, 111, 6);font-weight: bold;">/// Sets the text for the span element.</span>&#xD;&#xA;<span style="color: rgb(22, 111, 6); font-weight: bold;">///</span>&#xD;&#xA;<span style="color: rgb(0, 69, 255); font-weight: bold; font-wight: bold;">setText</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">text</span>) {&#xD;&#xA;&#xD;&#xA;<span style="font-weight: bold;">  </span><span style="color: rgb(0, 159, 255); font-weight: bold;">let</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">preElement</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">=</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">this</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">getPreElement</span>();&#xD;&#xA;&#xD;&#xA;<span style="font-weight: bold;">  </span><span style="color: rgb(0, 159, 255); font-weight: bold;">while</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">preElement</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">childNodes</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">length</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">&gt;</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">0</span>) <span style="color: rgb(84, 110, 122); font-weight: bold;">preElement</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">removeChild</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">preElement</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">childNodes</span>[<span style="color: rgb(84, 110, 122); font-weight: bold;">0</span>]);&#xD;&#xA;&#xD;&#xA;<span style="font-weight: bold;">  </span><span style="color: rgb(0, 159, 255); font-weight: bold;">if</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">text</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">indexOf</span>(<span style="color: rgb(255, 68, 0); font-weight: bold;">\'\'</span>) <span style="color: rgb(0, 159, 255); font-weight: bold;">&lt;</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">0</span>) <span style="color: rgb(84, 110, 122); font-weight: bold;">text</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">=</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">this</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">replaceText</span>(<span style="color: rgb(255, 105, 0); font-weight: bold;">\'\'</span>, <span style="color: rgb(255, 68, 0); font-weight: bold;">\'\'</span>);&#xD;&#xA;&#xD;&#xA;<span style="font-weight: bold;">  </span><span style="color: rgb(0, 159, 255); font-weight: bold;">let</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">lines</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">=</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">text</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">split</span>(<span style="color: rgb(255, 68, 0); font-weight: bold;">\'\'</span>);&#xD;&#xA;&#xD;&#xA;<span style="font-weight: bold;">  </span><span style="color: rgb(0, 159, 255); font-weight: bold;">for</span>(<span style="color: rgb(0, 159, 255); font-weight: bold;">let</span>  <span style="color: rgb(84, 110, 122); font-weight: bold;">i</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">=</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">0</span>; <span style="color: rgb(84, 110, 122); font-weight: bold;">i</span> <span style="color: rgb(0, 159, 255); font-weight: bold;">&lt;</span> <span style="color: rgb(84, 110, 122); font-weight: bold;">lines</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">length</span>; <span style="color: rgb(84, 110, 122); font-weight: bold;">i</span><span style="color: rgb(0, 159, 255); font-weight: bold;">++</span>)<span style="color: rgb(84, 110, 122); font-weight: bold;">preElement</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">appendChild</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">document</span>.<span style="color: rgb(0, 69, 255); font-weight: bold;">createTextNode</span>(<span style="color: rgb(84, 110, 122); font-weight: bold;">lines</span>[<span style="color: rgb(84, 110, 122); font-weight: bold;">i</span>] <span style="color: rgb(0, 159, 255); font-weight: bold;">+</span> <span style="color: rgb(255, 68, 0); font-weight: bold;">\'</span> <span style="color: rgb(255, 68, 0); font-weight: bold;">\'</span>));&#xD;&#xA;&#xD;&#xA;};'.replace(/&#xD;&#xA;/g,"\r\n")}customElements.define("text-edit-template",class extends TextEditBase{constructor(){super()}initialize(){super.initialize()}}),document.addEventListener("DOMContentLoaded",function(){setupBehavour(),setupTextEditContent()});